<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Manage Availability | MediBook</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>

<body class="bg-light">
 


<!-- =====================
     NAVBAR
===================== -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/admin">
      MediBook Admin
    </a>

    <a href="/logout" class="btn btn-outline-light btn-sm">
      Logout
    </a>
  </div>
</nav>

<div class="container py-5" style="max-width:800px">

  <!-- =====================
       AVAILABILITY FORM
       Used for BOTH create and update
  ===================== -->
  <div class="card shadow-sm p-4 mb-4">

    <h3 class="fw-bold mb-4 text-center">
  Set Practitioner Availability
</h3>


<form method="POST" action="/admin/availability">

  <% if (editAvailability) { %>
    <input
      type="hidden"
      name="availability_id"
      value="<%= editAvailability.id %>"
    >
  <% } %>

      <!-- PRACTITIONER -->
      <div class="mb-3">
        <label class="form-label">Practitioner</label>
        <select name="practitioner_id" class="form-select" required>
          <option value="">Select practitioner</option>

          <% practitioners.forEach(p => { %>
            <option
              value="<%= p.id %>"
              <%= editAvailability && editAvailability.practitioner_id === p.id ? "selected" : "" %>
            >
              <%= p.full_name %> - <%= p.service_name %>
            </option>
          <% }) %>

        </select>
      </div>

      <!-- DAY OF WEEK -->
      <div class="mb-3">
        <label class="form-label">Day of Week</label>
        <select name="day_of_week" class="form-select" required>
          <option value="">Select day</option>

          <% ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].forEach(d => { %>
            <option
              value="<%= d %>"
              <%= editAvailability && editAvailability.day_of_week === d ? "selected" : "" %>
            >
              <%= d %>
            </option>
          <% }) %>

        </select>
      </div>

      <!-- TIME RANGE -->
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Start Time</label>
          <input
            type="time"
            name="start_time"
            class="form-control"
            value="<%= editAvailability ? editAvailability.start_time.substring(0,5) : '' %>"
            required
          >
        </div>

        <div class="col-md-6">
          <label class="form-label">End Time</label>
          <input
            type="time"
            name="end_time"
            class="form-control"
            value="<%= editAvailability ? editAvailability.end_time.substring(0,5) : '' %>"
            required
          >
        </div>
      </div>

      <button class="btn btn-success w-100 mt-4">
        <%= editAvailability ? "Update Availability" : "Save Availability" %>
      </button>

    </form>
  </div>

  <!-- =====================
       EXISTING AVAILABILITY TABLE
  ===================== -->
  <div class="card shadow-sm p-4">

    <h5 class="fw-bold mb-3">
      Existing Availability
    </h5>

    <% if (!availability || availability.length === 0) { %>
      <p class="text-muted">No availability set yet.</p>
    <% } else { %>

        <input
  type="text"
  id="availabilitySearch"
  class="form-control mb-3"
  placeholder="Search practitioner name..."
>


    <div class="table-responsive">
      <table class="table table-striped table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th>Practitioner</th>
            <th>Service</th>
            <th>Day</th>
            <th>Time</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          <% availability.forEach(a => { %>
            <tr>
              <td><%= a.full_name %></td>
              <td><%= a.service_name %></td>
              <td><%= a.day_of_week %></td>
              <td>
                <%= a.start_time.substring(0,5) %> -
                <%= a.end_time.substring(0,5) %>
              </td>
              <td class="text-end d-flex gap-2 justify-content-end">

                <!-- EDIT -->
                <a
                  href="/admin/availability/<%= a.id %>/edit"
                  class="btn btn-sm btn-outline-primary"
                >
                  Edit
                </a>

                <!-- DELETE -->
                <form method="POST" action="/admin/availability/<%= a.id %>/delete">
                  <button
                    class="btn btn-sm btn-outline-danger"
                    onclick="return confirm('Delete this availability?')"
                  >
                    Delete
                  </button>
                </form>

              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>

    <% } %>
  </div>

</div>
<script>
  const searchInput = document.getElementById("availabilitySearch");

  searchInput.addEventListener("keyup", function () {
    const value = this.value.toLowerCase();
    const rows = document.querySelectorAll("tbody tr");

    rows.forEach(row => {
      const practitioner = row.children[0].innerText.toLowerCase();
      row.style.display = practitioner.includes(value) ? "" : "none";
    });
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
